# Driving through the world

## Visualising the map
We've been running previews through Carla's default [Map10](https://carla.readthedocs.io/en/latest/map_town10/).

Creating a route from spawn point 1 to spawn point 10, based on an aerial snapshot + OpenDRIVE lanes:

![Map aerial + lanes](../data/illustrations/route_plot_Town10HD.png)

## Default Agent driving

Importing the BasicAgent and BehaviorAgent from the Carla repo, we get routing and driving behaviour determined based on the state of simulation (not sensor info). 

Let's break down the behaviour:
The `GlobalRoutePlanner` plans a high level route between 2 points.

![Map Global Route](../data/illustrations/route_plot_Town10HD_grp.png)

The `LocalRoutePlanner` handles driving to the next waypoint, creating the actual vehicle controls:
- throttle for pressing the gas pedal (0 - 1) 
- brake for pressing the break pedal (0 - 1)
- steer for the steering wheel angle

We can use the Heads Up Display from the pygame setup of the scene to visualise what the local route planner decides at each point in time:

![HUD For car actions](../data/illustrations/closed_loop_hud.png)

I ran into some issues getting consistent behaviour when rendering an itinirerary vs the basic_agent drive. It seems `load_world()` and `get_world()` have different spawn points lists.

![Drive gif](../data/illustrations/closed_loop.gif)

[Closed loop drive with HUD (MP4)](../data/illustrations/closed_loop.mp4)

Turns are a challenge here, rapidly switching between throttle and break in a way that is not efficient, or mechanically feasible. This is marginally better with the BehaviourAgent, which drives faster. 

## Autonomous Vision-Only Agent Driving

Aiming to run a pretrained agent based on TransfuserV6 agent with Vision only, using [PCLA](https://github.com/MasoudJTehrani/PCLA) (Pretrained CARLA Leaderboard Agents).

Note - I tried a slimmed down setup with only the dependencies and weights for that one model, but the download and setup is still non-trivial. Unsure if I should harden this specific setup as I iterate, figure out the out-of-the-box PCLA setup, or try 